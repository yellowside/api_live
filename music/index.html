<!DOCTYPE html>
<html lang="zh-cn">
<head>
<meta charset="utf-8"/>
<meta name="referrer" content="no-referrer"/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8;"/>
<title>music</title>
<link rel="stylesheet" href="https://cdnjs.misidao.cn/ajax/libs/aplayer/1.10.1/APlayer.min.css">
<script src="https://player.alicdn.com/resource/base/lib/jquery-1.8.3.min.js"></script>
<script src="https://cdnjs.misidao.cn/ajax/libs/aplayer/1.10.1/APlayer.min.js"></script>
<style type="text/css">
h1{font-size:14px; color:#fff}
::-webkit-scrollbar{width: 12px;height: 12px;}/*滚动条整体*/
::-webkit-scrollbar-track{border-radius: 8px; background-color: rgba(225,255,255,.8);}/*轨道*/
::-webkit-scrollbar-thumb{border-radius: 8px; -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,.2); background-color: rgba(23,124,176,.8);}/*滑块*/
::-webkit-scrollbar-thumb:hover{border-radius: 8px; -webkit-box-shadow: inset 0 0 6px rgba(255,250,250,.2); background-color: rgba(255,78,32,.8);}/*效果*/
</style>
</head>
<body oncontextmenu="return false" onselectstart="return false">
<div id="APlayer"><h1>数据加载中…</h1></div>
<script type="text/javascript">
    async function fetchMusicData() {
        const urlParams = new URLSearchParams(window.location.search);
        const videoid = urlParams.get('id') || '';
        if (!videoid) {
            document.getElementById('APlayer').innerHTML = '<h1>错误：未提供音乐ID</h1>';
            return;
        }
        
        const apiUrl = `https://json.bingdou.cc/music/?id=${encodeURIComponent(videoid)}`;
        
        try {
            const response = await fetch(apiUrl);
            if (!response.ok) throw new Error('网络响应异常');
            
            const data = await response.json();
            if (!data || !data.data || !Array.isArray(data.data)) {
                throw new Error('数据格式错误');
            }
            
            const audioList = data.data.map(item => ({
                name: item.name,
                artist: item.artist,
                pic: item.pic,
                lrc: item.lrc,
                url: item.url
            }));
            
            return audioList;
            
        } catch (error) {
            console.error('获取音乐数据失败:', error);
            document.getElementById('APlayer').innerHTML = `<h1>加载失败: ${error.message}</h1>`;
            return [];
        }
    }
    
    async function initPlayer() {
        const audioList = await fetchMusicData();
        if (audioList.length === 0) return;
        
        const ap = new APlayer({
            element: document.getElementById('APlayer'),
            fixed: false,
            mini: false,
            volume: 0.9,
            preload: 'auto',
            mutex: true,
            autoplay: true,
            listFolded: false,
            showlrc: true,
            lrcType: 3,
            listmaxheight: '100%',
            audio: audioList
        });
    }
    
    initPlayer();
</script>
<div id="foot"></div>
<script>
$('#foot').load('../foot.html', function(response, status, xhr) {
  if (status === "error") {
    console.error("加载失败");
  }
});
</script>
</body>
</html>