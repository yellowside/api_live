<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<title>冰豆直播</title>
<style type="text/css">
<!--
html, body{margin: 0px 0px;width: 100%;height: 100%;}body {overflow:hidden;font-size: 12px;margin: 0px;background-color: #000000;}body, td, th {font-size: 13px;color: #999999;}img {border:0}a {outline: none;}a:link {color: #CCCCCC;text-decoration: none;}a:visited {color: #999999;text-decoration: none;}a:hover {color: #CCCCCC;text-decoration: none;}a:active {color: #CCCCCC;text-decoration: none;}#jm {float:left;display:inline; height:40px; line-height:40px;margin-left:10px;}#qh a {float:right;display:inline;display:block;height:40px;padding:0 5px;color:#999;line-height:40px;text-decoration:none;text-align:center; margin-right:8px;}#qh a.qh,#qh a:hover {color:#fff;}#qh a.linesort{color:#99cc00}#bingdouplayer {width:100%; height:100%;}#cover {width:100%; height:100%;z-index:2;position:absolute;}#lbottom {position:absolute;bottom:0px;left:0px;z-index:2;}#loading {position:absolute;bottom:0px;left:130px;right:0px;z-index:3;width:auto;height:100%}#script {height:0px}* {box-sizing: border-box;}nav a, #sideMenu {margin: 0 10px 0 0;text-shadow: 1px 1px 2px #212121;}#scrollingNews {color: #fcfcfc;}#sideMenu {float:left;display:inline;height:40px;line-height:40px;color:red;z-index:3;}#sideMenuContainer {background: #202020;height: 80%;padding: 10px;position: fixed;top: 56px;right: -130px;width: 130px;z-index: 4;}#sideMenuContainer h2 {color: #fcfcfc;font: 14px 'PT Sans', Helvetica, Arial, sans-serif;letter-spacing: 2px;text-transform: uppercase;}#sideMenuContainer a {display: block;padding: 5px 2px;}#sideMenuContainer a::after {content: attr(title);font: 13px 'PT Sans', Helvetica, Arial, sans-serif;padding-left: 5px;text-transform: uppercase;}
::-webkit-scrollbar{width: 12px;height: 12px;}/*滚动条整体*/
::-webkit-scrollbar-track{border-radius: 8px; background-color: rgba(225,255,255,.8);}/*轨道*/
::-webkit-scrollbar-thumb{border-radius: 8px; -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,.2); background-color: rgba(23,124,176,.8);}/*滑块*/
::-webkit-scrollbar-thumb:hover{border-radius: 8px; -webkit-box-shadow: inset 0 0 6px rgba(255,250,250,.2); background-color: rgba(255,78,32,.8);}/*效果*/
-->
</style>
<link href="https://cdnjs.misidao.cn/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
</head>
<body oncontextmenu="return false" onselectstart="return false">
<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0" style="background-color:#23262E">
<tr id="jiemu">
<td height="40" nowrap>
<div id="jm"><i class="fa fa-angle-double-right"></i> <span id="video-title">正在加载...</span>&nbsp;&nbsp;</div>
<div id="sideMenu"><span>[切换线路]</span></div>
<div id="sideMenuContainer" style="overflow-y:scroll;">
  <h2><i class="fa fa-angle-down"></i> 线路选择</h2>
  <div id="line-list"></div>
</div>
<div id="link"></div>
<td>
</tr>
<tr>
<td width="100%">
<div id="bingdouplayer">
<iframe name="player" id="player-iframe" src="" width="100%" height="100%" scrolling="no" allowtransparency="true" allowfullscreen="true" webkitallowfullscreen="true" mozallowfullscreen="true" frameborder="0"></iframe>
</div>
</td>
</tr>
</table>
<script src="https://player.alicdn.com/resource/base/lib/jquery-1.8.3.min.js"></script>
<script>
    // 获取 URL 中的 id 参数
    const urlParams = new URLSearchParams(window.location.search);
    const videoid = urlParams.get('id');

    // 判断是否为移动设备
    function isMobileDevice() {
      return /Mobile|Android|webOS|iPhone|iPad|iPod/i.test(navigator.userAgent);
    }

    let apiUrl = '';
    if (!videoid) {
      document.getElementById("video-title").innerText = "无效的视频ID";
    } else {
      if (isMobileDevice()) {
        apiUrl = `https://json.bingdou.cc/tv/m/?id=${videoid}`;
      } else {
        apiUrl = `https://json.bingdou.cc/tv/pc/?id=${videoid}`;
      }

      fetch(apiUrl)
        .then(response => response.json())
        .then(json => {
          const title = json.name || '未知名称';
          const list = json.data?.list || [];

          // 设置标题
          document.title = `${title} - 冰豆直播`;
          document.getElementById("video-title").innerText = title;

          // 设置默认播放器链接
          if (list.length > 0) {
            const defaultUrl = btoa(list[0].play_url); // base64 encode
            document.getElementById("player-iframe").src = `https://player.misidao.cn/base64/live/?url=${defaultUrl}`;
          }

          // 渲染线路列表
          const lineListDiv = document.getElementById("line-list");
          list.forEach((item, index) => {
            const link = document.createElement("a");
            link.href = `https://player.misidao.cn/base64/live/?url=${btoa(item.play_url)}`;
            link.target = "player";
            link.innerHTML = `<i class="fa fa-play-circle"></i>`;
            link.title = item.line;
            link.id = index + 1;
            link.onclick = () => setActiveLink(link.id);
            if (index === 0) link.style.color = "red"; // 默认选中第一个
            lineListDiv.appendChild(link);
          });
        })
        .catch(error => {
          console.error("获取数据失败", error);
          document.getElementById("video-title").innerText = "加载失败";
        });
    }

    let activeLinkId = null;
    function setActiveLink(id) {
      const allLinks = document.querySelectorAll("#line-list a");
      allLinks.forEach(link => link.style.color = "orange"); // 重置颜色
      document.getElementById(id).style.color = "red";
      activeLinkId = id;
    }
  </script>
<script type="text/javascript">
(function($){
  $.fn.sideToggle = function(options) {

    var settings = $.extend({
      moving : null, // which object to toggle?
      direction : null // toggle from this side of the window
    }, options);

    return this.click(function(){

      var thisDir = {};

      var moveThis = settings.moving;
      var dirPos = parseInt($(moveThis).css(settings.direction), 10);
      var menuWidth = $(moveThis).outerWidth();

      if (isNaN(dirPos)) {
        console.log("Please define the object's position in the css.");
      }

      if (dirPos === 0) {
        thisDir[settings.direction] = -menuWidth;
        $(moveThis).animate(thisDir);
      } else {
        thisDir[settings.direction] = 0;
        $(moveThis).animate(thisDir);
      }
    });
  }
}(jQuery));
</script>
<div id="foot"></div>
<script>
$('#link').load('../link.html', function(response, status, xhr) {
  if (status === "error") {
    console.error("加载失败");
  }
});
$('#foot').load('../foot.html', function(response, status, xhr) {
  if (status === "error") {
    console.error("加载失败");
  }
});
</script>
<script type="text/javascript">
  $(document).ready(function(){
    $('#sideMenu').sideToggle({
    moving: '#sideMenuContainer',
    direction: 'left'
    });

  });
</script>
</body>
</html>